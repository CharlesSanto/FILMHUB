@model FILMHUB.ViewModel.ReviewsViewModel;

@{
    ViewData["Title"] = "Reviews";
}

<div class="user-reviews-page">
    
    <div class="user-reviews-header">
        <h1 class="page-title">Minhas avaliações</h1>
        
        @if (Model.UserMovies.Any())
        {
            <p>@Model.UserMovies.Count @(Model.UserMovies.Count > 1 ? "filmes avaliados" : "filme avaliados")</p> 
        }
        
    </div>

    <hr/>
    
    @if (Model.Movies.Any())
    {
        @foreach (var movie in Model.Movies)
        {
            <div class="movie-review-card">
                <div class="movie-info">

                    <a asp-controller="Home" asp-action="MovieDetails" asp-route-id="@movie.Id">
                        <img loading="lazy" src="@($"https://image.tmdb.org/t/p/w780{movie.BackdropPath}")" alt="@movie.Title" class="movie-poster lazyload"/>
                    </a>

                    <div class="reviews-container">
                        <h2 class="movie-title">@movie.Title</h2>

                        @foreach (var review in Model.UserMovies.Where(r => r.MovieId == movie.Id))
                        {
                            var stars = (int)Math.Round((review.Rating ?? 0) / 2);

                            <div class="review-card">
                                <div class="review-header">
                                    <div class="review-stars">
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            <span class="stars @(i <= stars ? "filled" : "")">★</span>
                                        }
                                    </div>
                                    <p class="review-date">
                                        Avaliado em @(review.WatchedAt.Value.ToString("dd/MM/yyyy"))
                                    </p>
                                </div>
                                <p class="review-comment">@review.Review</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <hr class="hr-review"/>
        }
    }
    else
    {
        <p>Não tem filmes avaliados</p>
    }
</div>

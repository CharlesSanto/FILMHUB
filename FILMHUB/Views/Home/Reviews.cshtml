@model FILMHUB.ViewModel.ReviewsViewModel

@{
    ViewData["Title"] = "Reviews";
}

<section class="rv-page">

    <div class="rv-header">
        <h1 class="rv-title">Minhas avaliações</h1>

        @if (Model.UserMovies.Any())
        {
            <span class="rv-count">
                @Model.UserMovies.Count @(Model.UserMovies.Count > 1 ? "filmes avaliados" : "filme avaliado")
            </span>
        }
    </div>

    <hr />

    @if (Model.Movies.Any())
    {
        @foreach (var movie in Model.Movies)
        {
            <article class="rv-movie">
                <div class="rv-movie-layout">

                    <a asp-controller="Home"
                       asp-action="MovieDetails"
                       asp-route-id="@movie.Id"
                       class="rv-poster-link">
                        <img loading="lazy"
                             src="@($"https://image.tmdb.org/t/p/w780{movie.PosterPath}")"
                             alt="@movie.Title"
                             class="rv-poster lazyload" />
                    </a>

                    <div class="rv-reviews">
                        <h2 class="rv-movie-title">@movie.Title</h2>

                        @foreach (var review in Model.UserMovies.Where(r => r.MovieId == movie.Id))
                        {
                            var stars = (int)Math.Round((review.Rating ?? 0) / 2);

                            <div class="rv-review">
                                <div class="rv-review-header">
                                    <div class="rv-stars">
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            <span class="rv-star @(i <= stars ? "rv-star-filled" : "")">★</span>
                                        }
                                    </div>

                                    <span class="rv-date">
                                        Avaliado em @(review.WatchedAt.Value.ToString("dd/MM/yyyy"))
                                    </span>
                                </div>

                                <p class="rv-comment">@review.Review</p>
                            </div>
                        }
                    </div>

                </div>
            </article>

            <hr class="rv-divider" />
        }
    }
    else
    {
        <p class="rv-empty">Não tem filmes avaliados</p>
    }

</section>

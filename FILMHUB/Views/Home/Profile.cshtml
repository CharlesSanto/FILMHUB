@model FILMHUB.ViewModel.ProfileViewModel;

@{
    ViewData["Title"] = "Perfil";
}

@{
    var userName = Context.Session.GetString("UserName");
}

<div class="profile-container">
    
    <div class="profile-header">
    
        <div class="profile-header__user">
    
            <img 
                class="profile-header__avatar"
                src="~/img/temp-profile-photo-removebg-preview.png"
                alt="Foto do perfil"
            />

            <h1 class="profile-header__username">@userName</h1>
            
            <a class="profile-header__edit-link" href="#">
                Editar perfil
            </a>

        </div>

        <div class="profile-header__stats">
        
            <div class="profile-header__stat">
                <p class="profile-header__stat-number">45</p>
                <p class="profile-header__stat-label">Filmes</p>
            </div>
            
            <div class="vertical-line"></div>
            
            <div class="profile-header__stat">
                <p class="profile-header__stat-number">45</p>
                <p class="profile-header__stat-label">Este ano</p>
            </div>

        </div>

    </div>

    <div class="profile-favorites">
        <h2>Atualizações recentes</h2>
        <hr/>
    </div>
    
    @if (Model.Reviews.UserMovies.Any())
    {
        <div class="recent-reviews">
            <h2>Avaliações recentes</h2>
            
            <hr/>

            @foreach (var reviews in Model.Reviews.UserMovies.Take(5))
            {
                var stars = (int)Math.Round((reviews.Rating ?? 0) / 2);

                <div class="review-cards">
                    
                    @foreach(var titles in Model.Reviews.Movies.Where(r => r.Id == reviews.MovieId))
                    {
                        <p class="user-name-review">@titles.Title</p>
                    }
                    
                    <div class="review-header">

                        <div class="review-stars">
                            @for (int i = 1; i <= 5; i++)
                            {
                                <span class="star @(i <= stars ? "filled" : "")">★</span>
                            }
                        </div>

                        <p class="review-avaliation">
                            Avaliado em @(reviews.WatchedAt.HasValue
                                            ? reviews.WatchedAt.Value.ToString("dd/MM/yyyy")
                                            : "-")
                        </p>

                    </div>

                    <p class="review-comments">@reviews.Review</p>
                </div>
            }
        </div>
    }
    
</div>

